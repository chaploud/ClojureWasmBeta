# ベンチマーク結果 (hyperfine 高精度計測)
#
# 計測方法: hyperfine --warmup 2 --runs 5 (mean)
# メモリ: /usr/bin/time -l (maximum resident set size)
# 日付: 2026-01-29

env:
  cpu: Apple M4 Pro
  ram: 48 GB
  os: Darwin 25.2.0 (arm64)
  tool: hyperfine 1.20.0

benchmarks:
  fib30:
    description: "再帰フィボナッチ fib(30) — 関数呼び出しオーバーヘッド"
    expected_result: 832040
  sum_range:
    description: "range(1000000) + sum — 数値シーケンス処理"
    expected_result: 499999500000
  map_filter:
    description: "filter odd / map square / take 10000 / sum — HOF チェイン"
    expected_result: 1333333330000
  string_ops:
    description: "10000回の upper-case + 文字列結合 (apply str)"
    expected_result: 88890
  data_transform:
    description: "10000個のマップ/構造体を作成・変換"
    expected_result: 10000

# 全言語結果 (cold start)
# time_ms: hyperfine mean (ms), mem_mb: peak RSS (MB)
results:
  c:
    version: "Apple clang 17.0.0"
    fib30: {time_ms: 6.43, mem_mb: 1.8}
    sum_range: {time_ms: 4.11, mem_mb: 1.8}
    map_filter: {time_ms: 3.23, mem_mb: 1.8}
    string_ops: {time_ms: 5.13, mem_mb: 1.8}
    data_transform: {time_ms: 3.76, mem_mb: 1.8}
  cpp:
    version: "Apple clang 17.0.0"
    fib30: {time_ms: 5.19, mem_mb: 1.8}
    sum_range: {time_ms: 6.99, mem_mb: 1.8}
    map_filter: {time_ms: 3.95, mem_mb: 1.8}
    string_ops: {time_ms: 2.22, mem_mb: 1.8}
    data_transform: {time_ms: 3.94, mem_mb: 1.8}
  zig:
    version: "0.15.2"
    fib30: {time_ms: 4.50, mem_mb: 1.8}
    sum_range: {time_ms: 3.81, mem_mb: 1.8}
    map_filter: {time_ms: 3.98, mem_mb: 1.8}
    string_ops: {time_ms: 3.86, mem_mb: 1.8}
    data_transform: {time_ms: 3.27, mem_mb: 1.8}
  java:
    version: "OpenJDK 21.0.9"
    fib30: {time_ms: 32.60, mem_mb: 40.8}
    sum_range: {time_ms: 35.23, mem_mb: 42.0}
    map_filter: {time_ms: 44.08, mem_mb: 42.8}
    string_ops: {time_ms: 49.04, mem_mb: 43.8}
    data_transform: {time_ms: 31.52, mem_mb: 42.2}
  # JVM Clojure (cold start): clojure -M file.clj
  # 0.3-0.4s の大部分は JVM 起動 + Clojure ランタイムロード
  clojure_cold:
    version: "1.12.4 (Clojure CLI 1.12.4.1582, OpenJDK 21)"
    fib30: {time_ms: 383.59, mem_mb: 116.0}
    sum_range: {time_ms: 307.20, mem_mb: 107.6}
    map_filter: {time_ms: 382.95, mem_mb: 113.8}
    string_ops: {time_ms: 320.05, mem_mb: 108.7}
    data_transform: {time_ms: 384.69, mem_mb: 113.1}
  # JVM Clojure (warm): JIT warm-up 3回後、5回計測の中央値
  # 1 JVM プロセスで全ベンチを連続実行 (clj_warm_bench.clj)
  # メモリは計測不可 (プロセス内計測のため)
  clojure_warm:
    version: "1.12.4 (OpenJDK 21)"
    fib30: {time_ms: 10.06}
    sum_range: {time_ms: 5.90}
    map_filter: {time_ms: 1.41}
    string_ops: {time_ms: 1.91}
    data_transform: {time_ms: 1.52}
  # babashka: GraalVM ネイティブコンパイル済み Clojure (sci ベース)
  babashka:
    version: "v1.12.214"
    fib30: {time_ms: 151.97, mem_mb: 70.5}
    sum_range: {time_ms: 21.73, mem_mb: 58.9}
    map_filter: {time_ms: 12.56, mem_mb: 31.7}
    string_ops: {time_ms: 12.90, mem_mb: 32.3}
    data_transform: {time_ms: 13.21, mem_mb: 33.7}
  ruby:
    version: "3.3.6 (YJIT)"
    fib30: {time_ms: 134.97, mem_mb: 17.0}
    sum_range: {time_ms: 102.59, mem_mb: 16.9}
    map_filter: {time_ms: 97.06, mem_mb: 17.1}
    string_ops: {time_ms: 98.03, mem_mb: 17.6}
    data_transform: {time_ms: 99.87, mem_mb: 18.3}
  python:
    version: "3.14.2"
    fib30: {time_ms: 76.69, mem_mb: 14.3}
    sum_range: {time_ms: 20.05, mem_mb: 14.3}
    map_filter: {time_ms: 15.12, mem_mb: 14.4}
    string_ops: {time_ms: 17.69, mem_mb: 15.1}
    data_transform: {time_ms: 16.90, mem_mb: 17.0}
  clojurewasmbeta:
    version: "VM backend, ReleaseFast"
    fib30: {time_ms: 69.11, mem_mb: 2.1}
    sum_range: {time_ms: 12.52, mem_mb: 2.2}
    map_filter: {time_ms: 2.29, mem_mb: 2.2}
    string_ops: {time_ms: 6.36, mem_mb: 14.0}
    data_transform: {time_ms: 10.63, mem_mb: 22.5}
  # ClojureWasmBeta (warm): nREPL 経由、warm-up 3回後 5回計測の中央値
  # System/nanoTime でプロセス内計測。string_ops はクラッシュのため壁時計 (精度低)
  clojurewasmbeta_warm:
    version: "VM backend, nREPL"
    fib30: {time_ms: 63.8}
    sum_range: {time_ms: 10.4}
    map_filter: {time_ms: 0.4}
    string_ops: {time_ms: 59.4, note: "wall-clock (System/nanoTime wrapper crash)"}
    data_transform: {time_ms: 6.7}
